<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xsi:schemaLocation="http://www.w3.org/MarkUp/SCHEMA/xhtml11.xsd"
     xml:lang="en">
  <head>
    <title>Information Center for ARM</title>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    <link type="text/css" rel="stylesheet" media="all" href="file://$TOOLKIT_DIR$/doc/infocenter/style/ewic.css" />
  </head>
  <body>
  <div id="topbanner"></div>
  <div id="titlebanner_small">
    <h2>Information Center for ARM</h2>
  </div>
  <div class="breadcrumb"><a href="$TOOLKIT_DIR$/doc/infocenter/index.ENU.html">Information Center for ARM</a> | EXAMPLES</div>
  <div class="mainblock">
   <h2>Example description</h2>

   <pre>  <!--Insert readme.txt-->
	How to use the I2C to drive an EEPROM memory

	Example Description 

This firmware provides a basic example of how to use the I2C firmware library and
an associate I2C EEPROM driver to communicate with an I2C EEPROM device (here the
example is interfacing with M24LR64 EEPROM)

I2C peripheral is configured in Master transmitter during write operation and in
Master receiver during read operation from I2C EEPROM. 

The peripheral used is I2C1 but can be configured by modifying the defines values
in stm320518_eval.h file.
The maximum speed of communication with M24LR64 is 400kHz.
The speed of communication is configured by setting the value of sEE_I2C_TIMING define
in stm320518c_eval_i2c_ee.h file.

For M24LR64 devices all the memory is accessible through the two-bytes 
addressing mode and need to define block addresses. In this case, the physical 
address has to be defined according to the address pins (E1, E2) connection.

This address is defined in stm320518_eval_i2c_ee.h. 
The EEPROM addresses where the program start the write and the read operations 
is defined in the main.c file. 

First, the content of Tx1Buffer is written to the sEE_WRITE_ADDRESS1 and the
written data are read. The written and the read buffers data are then compared.
Following the read operation, the program waits that the EEPROM reverts to its 
Standby state. A second write operation is, then, performed and this time, Tx2Buffer
is written to sEE_WRITE_ADDRESS2, which represents the address just after the last 
written one in the first write. After completion of the second write operation, the 
written data are read. The contents of the written and the read buffers are compared.

All transfers are managed in Polling mode by calling sEE_ReadBuffer() or 
sEE_WriteBuffer() function.

User should refer to stm320518_eval.h file to select which EEPROM use in this example.
    
This example provides the possibility to use the LCD screen for messages display
(transfer status: PASSED, FAILED).
To enable this option uncomment the define ENABLE_LCD_MSG_DISPLAY in the main.c
file.  


	Directory contents 

  - I2C/I2C_EEPROM/stm32f0xx_conf.h    Library Configuration file
  - I2C/I2C_EEPROM/stm32f0xx_it.c      Interrupt handlers
  - I2C/I2C_EEPROM/stm32f0xx_it.h      Interrupt handlers header file
  - I2C/I2C_EEPROM/main.c              Main program
  - I2C/I2C_EEPROM/main.h              Main program header file   
  - I2C/I2C_EEPROM/system_stm32f0xx.c  STM32F0xx system source file
  
 note The "system_stm32f0xx.c" is generated by an automatic clock configuration 
      tool and can be easily customized to meet user application requirements. 
      To select different clock setup, use the "STM32F0xx_Clock_Configuration_VX.Y.Z.xls" 
      provided with the AN4055 package available on <a href="http://www.st.com/internet/mcu/class/1734.jsp">  ST Microcontrollers </a>
         
	Hardware and Software environment

  - This example runs on STM32F0xx Devices.
  
  - This example has been tested with STMicroelectronics STM320518-EVAL (STM32F0xx)
    evaluation board and can be easily tailored to any other supported device 
    and development board. 

  - STM320518-EVAL Set-up
    - When communicating with M24LR64 EEPROM, make sure that ANT7-M24LR is inserted in CN2 connector.      


	How to use it ? 

In order to make the program work, you must do the following :
 - Copy all source files from this example folder to the template folder under
   Project\STM32F0xx_StdPeriph_Templates
 - Open your preferred toolchain 
 - Add the following file the project source list
     - Utilities/STM32_EVAL/STM320518_EVAL/stm320518_eval_i2c_ee.c
 - Before building the project please make sure that "USE_DEFAULT_TIMEOUT_CALLBACK" 
   define is removed from Preprocessor defines under C/C++ compiler settings.
 - Rebuild all files and load your image into target memory
 - Run the example

***********************************************************************************

	Communication between I2C and STLM75 Temperature sensor

	Example Description 

This example provides a description of how to use the I2C to communicate with 
an STLM75 (or a compatible device) I2C temperature sensor is mounted on the 
STM320518-EVAL board and used to get instantaneous external temperature
(-55°C to +125°C).
 
Thanks to STM32 I2C SMBus feature, we can easily monitor the temperature 
variations. This is managed by the SMBus Alert which is generating a dedicated 
interrupt informing the system that the temperature is out of the selected 
ranges.

The user can configure the TOS and THYS thanks to a dedicated define values in 
the code.

By default the STM320518-EVAL demo are setting them to (see main.c file):
  
   #define TEMPERATURE_THYS 31
   #define TEMPERATURE_TOS 32


	Directory contents 

  - I2C/I2C_TSENSOR/stm32f0xx_conf.h    Library Configuration file
  - I2C/I2C_TSENSOR/stm32f0xx_it.c      Interrupt handlers
  - I2C/I2C_TSENSOR/stm32f0xx_it.h      Interrupt handlers header file
  - I2C/I2C_TSENSOR/main.c              Main program
  - I2C/I2C_TSENSOR/main.h              Main program header file   
  - I2C/I2C_TSENSOR/system_stm32f0xx.c  STM32F0xx system source file
  
 note The "system_stm32f0xx.c" is generated by an automatic clock configuration 
      tool and can be easily customized to meet user application requirements. 
      To select different clock setup, use the "STM32F0xx_Clock_Configuration_VX.Y.Z.xls" 
      provided with the AN4055 package available on <a href="http://www.st.com/internet/mcu/class/1734.jsp">  ST Microcontrollers </a>

         
	Hardware and Software environment

  - This example runs on STM32F0xx Devices.
  
  - This example has been tested with STMicroelectronics STM320518-EVAL (STM32F0xx)
    evaluation board and can be easily tailored to any other supported device 
    and development board. 

  - STM320518-EVAL Set-up
    - STLM75 I2C temperature sensor is already available on this board.


	How to use it ? 

In order to make the program work, you must do the following :
 - Copy all source files from this example folder to the template folder under
   Project\STM32F0xx_StdPeriph_Templates
 - Open your preferred toolchain 
 - Add the following file the project source list
     - Utilities/STM32_EVAL/STM320518_EVAL/stm320518_eval_i2c_tsensor.c
 - Rebuild all files and load your image into target memory
 - Run the example

***********************************************************************************

	I2C Communication Boards Data Exchange using CPAL Library

	Example Description 

This example shows how to use the CPAL library to control I2C devices and 
communicate between two different boards.

To use this example, you need to load the same software into two STM32 boards
(let's call them  Board A and Board B) then connect these two boards through I2C
lines and Gnd.

*------------------------------------------------------------------------------*
|                BOARD A                                BOARD B                |
|         ____________________                   ____________________          |
|        |                    |                 |                    |         |
|        |                    |                 |                    |         | 
|        |     __________     |                 |     __________     |         |
|        |    |I2C Device|____|_______SCL_______|____|I2C Device|    |         |
|        |    |__________|____|_______SDA_______|____|__________|    |         |
|        |                    |                 |                    |         |
|        |                    |                 |                    |         |
|        |  Tamper      Key   |                 |  Tamper      Key   |         |
|        |   _           _    |                 |   _           _    |         |
|        |  |_|         |_|   |                 |  |_|         |_|   |         |
|        |                    |                 |                    |         |
|        |             GND O--|-----------------|--O GND             |         |
|        |____________________|                 |____________________|         |
|                                                                              |
|                                                                              |
*------------------------------------------------------------------------------*

The example software perform the following actions:
 - At startup, Boards A & B are both in slave receiver mode and wait for messages 
   to be received.
 - When a push button is pressed, for example on Board A, the master transmitter 
   mode is activated and a message is sent to Board B containing identification 
   of the action relative to the push button.
 - Once a message is correctly sent, Board A activates the master transmitter mode 
   permanently and disables the slave receiver mode.
 - Once a message is received and correctly recognized, Board B activate the
   receiver mode and disable the transmitter mode. (push buttons interrupts are
   still active but message sending is disabled).
 - According to the push button pressed, a value is affected to a Timer which 
   generates periodic high priority interrupts. At each interrupt, a status message
   is sent to Board B. The period of Timer interrupts is variable depending on
   the push button pressed.    
 - When Key is pressed Board A send specific message (tSignal1) to Board B and set 
   the period of Timer to 1.5 seconds. When Tamper is pressed specific message (tSignal2)
   is sent and the period of Timer is set to 0.375 seconds.

For each event (message received, message transmitted, error occur ...) a 
relative information is displayed on the LCD screen. When the same event is 
repeated, the line color is switched to highlight the event occurrence.

the Mode of Board (transmitter or receiver) is monitored by LEDs:
      - LED2 is toggling when transmitter mode is activated.
      - LED3 is toggling when receiver mode is activated. 

LED1 and LED4 are toggling by an interrupt generated by TIM6 each 50ms.

The programming model of I2C communication can be selected (DMA or Interrupt) in 
stm32f0xx_i2c_cpal_conf.h file by commenting or uncommenting these defines in
Section 2 (Transfer Options Configuration):
              #define CPAL_I2C_DMA_PROGMODEL
              #define CPAL_I2C_IT_PROGMODEL
Note : Only one define must selected. If these two defines are uncommented DMA Programming 
model is selected and the code size of this example will increase.

 
** UserCallbacks :

   - CPAL_TIMEOUT_UserCallback : This Callback is called to manage timeout error.
      In this Callback I2C device is reinitialized.
      
   - CPAL_I2C_ERR_UserCallback : This Callback is called to manage Device error .  
      In this Callback I2C device is reinitialized.
      Note: 
      If you want to generate an I2C error, you can disconnect I2C_SCL/I2C_SDA connector.
      In this case the I2C communication will be corrupted and the CPAL I2C error callbacks
      will be entered. If you fit back the jumper or connector, the communication should be 
      recovered immediately thanks to CPAL error management. 
      
   - CPAL_I2C_TXTC_UserCallback : This Callback is called when Write operation 
      is completed. In this Callback only information relative to communication 
      are displayed on LCD screen.
      
   - CPAL_I2C_RXTC_UserCallback : This Callback is called when Read operation 
      is completed. In this Callback received data are compared and transfer 
      status is displayed on LCD screen.
 

	Directory contents 

  - I2C/I2C_TwoBoards/stm32f0xx_conf.h                   Library Configuration file
  - I2C/I2C_TwoBoards/stm32f0xx_it.c                     Interrupt handlers
  - I2C/I2C_TwoBoards/stm32f0xx_it.h                     Interrupt handlers header file
  - I2C/I2C_TwoBoards/main.c                             Main program
  - I2C/I2C_TwoBoards/main.h                             Main program header file   
  - I2C/I2C_TwoBoards/system_stm32f0xx.c                 STM32F0xx system source file
  - I2C/I2C_TwoBoards/stm32f0xx_i2c_cpal_conf.h          CPAL Library Configuration file
  - I2C/I2C_TwoBoards/stm32f0xx_i2c_cpal_usercallback.c  CPAL Usercallbacks definition
  
  
 note The "system_stm32f0xx.c" is generated by an automatic clock configuration 
      tool and can be easily customized to meet user application requirements. 
      To select different clock setup, use the "STM32F0xx_Clock_Configuration_VX.Y.Z.xls" 
      provided with the AN4055 package available on <a href="http://www.st.com/internet/mcu/class/1734.jsp">  ST Microcontrollers </a>

         
	Hardware and Software environment

  - This example runs on STM32F0xx Devices.
  
  - This example has been tested with STMicroelectronics STM320518-EVAL (STM32F0xx)
    evaluation board and can be easily tailored to any other supported device 
    and development board. 

 - The same example should be loaded in two evaluation boards.
    
 - STM320518-EVAL Set-up
    - Use two boards should be connected as follows:
       - Connect I2C1 SCL pin (PB6) to I2C1 SCL pin (PB6)
       - Connect I2C1 SDA pin (PB7) to I2C SDA pin (PB7)
       - Connect Gnd pins of two boards.

    
	How to use it ? 

In order to make the program work, you must do the following :
 - Copy all source files from this example folder to the template folder under
   Project\STM32F0xx_StdPeriph_Templates
 - Open your preferred toolchain
 - Add the following files the project source list
     - Libraries/STM32F0xx_CPAL_Driver/stm32f0xx_i2c_cpal.c
     - Libraries/STM32F0xx_CPAL_Driver/stm32f0xx_i2c_cpal_hal.c
     - stm32f0xx_i2c_cpal_usercallback.c
 - Rebuild all files and load your image into target memory
 - Run the example

***********************************************************************************

	I2C WakeUp from stop mode
	
	Example Description 

This example shows how to use the WakeUp from STOP feature of I2C device using 
the CPAL library. This example requires two boards, one configured in master mode
and another one configured in slave mode.

The I2C of the slave board is configured as slave device which enters in STOP mode
after activating the WakeUp from stop ability. 

The master board is used to WakeUp the slave board from STOP. By pushing the key Button
of the master board, the I2C device initialize a communication by sending a Start condition
followed by the address of slave device. 

The slave device is woken Up from STOP if it recognizes its own address. 
The received data is checked and the result is displayed on LCD. 

This procedure is repeated infinitely.

The main.h file contains defines(I2C_MASTER, I2C_SLAVE) that select the type of 
the board(master or slave).

Note: Before entering STOP The I2C clock source must be set to HSI.


	Directory contents 

  - I2C/I2C_WakeUpFromStop/stm32f0xx_conf.h    Library Configuration file
  - I2C/I2C_WakeUpFromStop/stm32f0xx_it.c      Interrupt handlers
  - I2C/I2C_WakeUpFromStop/stm32f0xx_it.h      Interrupt handlers header file
  - I2C/I2C_WakeUpFromStop/main.c              Main program
  - I2C/I2C_WakeUpFromStop/main.h              Main program header file   
  - I2C/I2C_WakeUpFromStop/system_stm32f0xx.c  STM32F0xx system source file
  
 note The "system_stm32f0xx.c" is generated by an automatic clock configuration 
      tool and can be easily customized to meet user application requirements. 
      To select different clock setup, use the "STM32F0xx_Clock_Configuration_VX.Y.Z.xls" 
      provided with the AN4055 package available on <a href="http://www.st.com/internet/mcu/class/1734.jsp">  ST Microcontrollers </a>

         
	Hardware and Software environment

  - This example runs on STM32F0xx Devices.
  
  - This example has been tested with STMicroelectronics STM320518-EVAL (STM32F0xx)
    evaluation board and can be easily tailored to any other supported device 
    and development board. 

  - STM320518-EVAL Set-up
    - Use two boards should be connected as follow after loading the example:
       - Connect I2C1 SCL pin (PB6) to I2C1 SCL pin (PB6)
       - Connect I2C1 SDA pin (PB7) to I2C1 SDA pin (PB7)
       - Connect Gnd pins of two boards.

    
	How to use it ? 

In order to make the program work, you must do the following:
 - Copy all source files from this example folder to the template folder under
   Project\STM32F0xx_StdPeriph_Templates
 - Open your preferred toolchain
 - Add the following files the project source list
     - Libraries/STM32F0xx_CPAL_Driver/stm32f0xx_i2c_cpal.c
     - Libraries/STM32F0xx_CPAL_Driver/stm32f0xx_i2c_cpal_hal.c
     - stm32f0xx_i2c_cpal_usercallback.c 
 - Rebuild all files and load your image into target memory
 - Run the example
   </pre>
  </div>
  </body>
</html>

